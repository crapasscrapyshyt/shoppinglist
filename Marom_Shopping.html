<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#14b8a6">
    <!-- ××™×™×§×•×Ÿ ×œ×œ×©×•× ×™×ª ×‘×“×¤×“×¤×Ÿ -->
    <link rel="icon" type="image/png" href="shopping-icon.png">

    <!-- ××™×™×§×•×Ÿ ×œ××¡×š ×”×‘×™×ª ×‘××™×™×¤×•×Ÿ -->
    <link rel="apple-touch-icon" href="shopping-icon.png">
    
    <title>×¨×©×™××ª ×§× ×™×•×ª ×œ×‘×™×ª ××©×¤×—×ª ××¨×•×</title>
    <link rel="icon" href__="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›’</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, #F0F7F4, #E8F4F8);
            min-height: 100vh;
            direction: rtl;
            -webkit-tap-highlight-color: transparent;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 16px;
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .app-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #2dd4bf, #0d9488);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(13, 148, 136, 0.3);
            font-size: 20px;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        .subtitle {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.5;
        }

        main {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .control-bar {
            padding: 16px;
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        select, input[type="text"] {
            flex: 1;
            min-width: 120px;
            height: 44px;
            padding: 0 12px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 0.875rem;
            background: white;
            color: #374151;
            direction: rtl;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #14b8a6;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .btn {
            height: 44px;
            padding: 0 16px;
            border: none;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
            color: white;
            box-shadow: 0 2px 4px rgba(13, 148, 136, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0d9488, #0f766e);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        .btn-outline {
            background: white;
            border: 1px solid #e5e7eb;
            color: #6b7280;
        }

        .btn-outline:hover {
            background: #f9fafb;
        }

        .btn-ghost {
            background: transparent;
            color: #6b7280;
        }

        .btn-ghost:hover {
            background: #f3f4f6;
        }

        .btn-danger {
            background: white;
            border: 1px solid #fecaca;
            color: #dc2626;
        }

        .btn-danger:hover {
            background: #fef2f2;
        }

        .btn-full {
            width: 100%;
        }

        .add-item-toggle {
            width: 100%;
            height: 44px;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .add-item-toggle:hover {
            border-color: #14b8a6;
            color: #14b8a6;
            background: rgba(20, 184, 166, 0.05);
        }

        .add-item-form {
            background: #f9fafb;
            border-radius: 12px;
            padding: 12px;
            display: none;
        }

        .add-item-form.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
        }

        .category-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-title {
            flex: 1;
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .category-badge {
            padding: 4px 10px;
            background: #ccfbf1;
            color: #0d9488;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .category-items {
            padding: 12px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 4px;
        }

        @media (max-width: 600px) {
            .category-items {
                grid-template-columns: 1fr;
            }
        }

        .item-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .item-row:hover {
            background: #f9fafb;
        }

        .item-row.selected {
            background: #f0fdfa;
            border-color: #99f6e4;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .item-row.selected .checkbox {
            background: #14b8a6;
            border-color: #14b8a6;
        }

        .checkbox::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .item-row.selected .checkbox::after {
            opacity: 1;
        }

        .item-name {
            flex: 1;
            font-size: 0.875rem;
            color: #374151;
            transition: all 0.2s;
        }

        .item-row.selected .item-name {
            color: #0f766e;
            font-weight: 500;
        }

        .item-name.custom {
            font-style: italic;
        }

        .quantity-controls {
            display: none;
            align-items: center;
            gap: 4px;
            animation: fadeIn 0.2s ease;
        }

        .item-row.selected .quantity-controls {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            color: #6b7280;
        }

        .qty-btn:hover {
            background: #f3f4f6;
        }

        .qty-btn:active {
            transform: scale(0.95);
        }

        input[type="number"] {
            width: 48px;
            height: 28px;
            text-align: center;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .unit-label {
            font-size: 0.625rem;
            color: #9ca3af;
            width: 40px;
            text-align: center;
        }

        .summary-header {
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .summary-content {
            padding: 16px;
        }

        .summary-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .summary-buttons .btn {
            flex: 1;
        }

        .more-actions {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .more-actions.show {
            display: grid;
            animation: slideDown 0.2s ease;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 0.875rem;
            font-family: monospace;
            background: #f9fafb;
            resize: vertical;
            direction: rtl;
        }

        textarea:focus {
            outline: none;
            border-color: #14b8a6;
        }

        .checklist-header {
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            background: linear-gradient(135deg, #eff6ff, #ecfeff);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .checklist-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-badge {
            padding: 4px 10px;
            background: #dbeafe;
            color: #2563eb;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .progress-badge.complete {
            background: #dcfce7;
            color: #16a34a;
        }

        .checklist-content {
            padding: 16px;
        }

        .checklist-empty {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }

        .checklist-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        .checklist-category {
            margin-bottom: 16px;
        }

        .checklist-category-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checklist-category-title::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #60a5fa;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
            border: 1px solid #f3f4f6;
            margin-bottom: 6px;
        }

        .checklist-item:hover {
            border-color: #e5e7eb;
        }

        .checklist-item.bought {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }

        .checklist-checkbox {
            width: 26px;
            height: 26px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .checklist-item.bought .checklist-checkbox {
            background: #22c55e;
            border-color: #22c55e;
        }

        .checklist-checkbox::after {
            content: 'âœ“';
            color: white;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
        }

        .checklist-item.bought .checklist-checkbox::after {
            opacity: 1;
        }

        .checklist-item-name {
            flex: 1;
            font-size: 0.875rem;
            color: #374151;
            transition: all 0.2s;
        }

        .checklist-item.bought .checklist-item-name {
            color: #16a34a;
            text-decoration: line-through;
            opacity: 0.6;
        }

        .checklist-item-qty {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 20px;
            background: #e5e7eb;
            color: #6b7280;
            transition: all 0.2s;
        }

        .checklist-item.bought .checklist-item-qty {
            background: #dcfce7;
            color: #16a34a;
        }

        .checklist-done-icon {
            display: none;
            color: #22c55e;
            font-size: 20px;
        }

        .checklist-item.bought .checklist-done-icon {
            display: block;
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .btn-completion {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            color: #b45309;
        }

        .btn-completion:hover {
            background: #fef3c7;
        }

        .success-message {
            text-align: center;
            padding: 16px;
            animation: fadeIn 0.3s ease;
        }

        .success-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: #dcfce7;
            color: #16a34a;
            border-radius: 30px;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1f2937;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 0.875rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-top">
                <div class="app-icon">ğŸ›’</div>
                <h1>×¨×©×™××ª ×§× ×™×•×ª ×œ×‘×™×ª ××©×¤×—×ª ××¨×•×</h1>
            </div>
            <p class="subtitle">×‘×—×¨/×™ ×§×˜×’×•×¨×™×”, ×¡×× ×™ ××” ×©×¦×¨×™×š ×œ×§× ×•×ª â†’ "×™×¦×™×¨×ª ×¨×©×™××”" â†’ ×”×¢×ª×§×™ ××• ×¢×‘×¨×™ ×œ×¦'×§ ×œ×™×¡×˜ ×‘×¡×•×¤×¨</p>
        </div>
    </header>

    <main>
        <!-- Control Bar -->
        <div class="card control-bar">
            <div class="control-row">
                <select id="categoryFilter">
                    <option value="×›×œ ×”×§×˜×’×•×¨×™×•×ª">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                </select>
                <button class="btn btn-outline" onclick="showAllCategories()">ğŸ‘ ×”×¦×’ ×”×›×œ</button>
                <button class="btn btn-outline" onclick="clearAllSelections()">ğŸ—‘ × ×§×” ×¡×™××•× ×™×</button>
            </div>
            <button class="add-item-toggle" onclick="toggleAddForm()">
                â• ×”×•×¡×¤×ª ×¤×¨×™×˜ ×—×“×© ×œ×¨×©×™××”...
            </button>
            <div id="addItemForm" class="add-item-form">
                <div class="control-row">
                    <input type="text" id="newItemName" placeholder="×©× ×”×¤×¨×™×˜...">
                    <select id="newItemCategory"></select>
                </div>
                <div class="control-row">
                    <button class="btn btn-primary" onclick="addNewItem()">â• ×”×•×¡×£ ×¤×¨×™×˜</button>
                    <button class="btn btn-outline" onclick="toggleAddForm()">×‘×™×˜×•×œ</button>
                </div>
            </div>
        </div>

        <!-- Categories Container -->
        <div id="categoriesContainer"></div>

        <!-- Summary Card -->
        <div class="card">
            <div class="summary-header">
                <span>ğŸ“</span>
                <h2>×¨×©×™××” ××¡×•×›××ª ×œ×”×¢×ª×§×” / ×¦'×§ ×œ×™×¡×˜</h2>
            </div>
            <div class="summary-content">
                <div class="summary-buttons">
                    <button class="btn btn-primary" onclick="generateList()">ğŸ“‹ ×™×¦×™×¨×ª ×¨×©×™××”</button>
                    <button class="btn btn-secondary" onclick="generateChecklist()">ğŸ›’ ×¦'×§ ×œ×™×¡×˜ ×œ×¡×•×¤×¨</button>
                </div>
                <button class="btn btn-ghost btn-full" onclick="toggleMoreActions()">
                    ×¢×•×“ ×¤×¢×•×œ×•×ª â–¾
                </button>
                <div id="moreActions" class="more-actions">
                    <button class="btn btn-outline" onclick="clearSummary()">ğŸ—‘ ××—×™×§×ª ×¨×©×™××”</button>
                    <button class="btn btn-outline" onclick="clearAllSelections()">â†º × ×§×” ×¡×™××•× ×™×</button>
                    <button class="btn btn-outline" onclick="copyToClipboard()">ğŸ“‹ ×”×¢×ª×§ ×¨×©×™××”</button>
                    <button class="btn btn-danger" onclick="fullReset()">âš  ××™×¤×•×¡ ××œ×</button>
                </div>
                <textarea id="summaryText" placeholder="×”×¨×©×™××” ×ª×•×¤×™×¢ ×›××Ÿ..." readonly></textarea>
            </div>
        </div>

        <!-- Supermarket Checklist -->
        <div class="card" id="checklistCard">
            <div class="checklist-header">
                <h2>ğŸ›’ ×¦'×§ ×œ×™×¡×˜ ×‘×¡×•×¤×¨</h2>
                <span id="progressBadge" class="progress-badge">0/0</span>
            </div>
            <div class="checklist-content" id="checklistContent">
                <div class="checklist-empty">
                    <div class="checklist-empty-icon">ğŸ›’</div>
                    <p>×¡×× ×• ×¤×¨×™×˜×™× ×‘×¨×©×™××” ×•×œ×—×¦×• ×¢×œ "×¦'×§ ×œ×™×¡×˜ ×œ×¡×•×¤×¨"</p>
                </div>
            </div>
        </div>
    </main>

    <div id="toast" class="toast"></div>

    <script>
        const DEFAULT_CATEGORIES = {
            'ğŸ¥¬ ×™×¨×§×•×ª': [
                { name: '××¨×˜×™×©×•×§ ×™×¨×•×©×œ××™', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×‘×–×™×œ×™×§×•×', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×‘×˜×˜×”', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×‘×¦×œ ×™×¨×•×§', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×‘×¨×•×§×•×œ×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×’×–×¨', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×“×œ×¢×ª', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×—×¡×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×˜×™××™×Ÿ', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×›×•×¡×‘×¨×”', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×›×¨×•×‘ ×œ×‘×Ÿ/×¡×’×•×œ', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×›×¨×•×‘×™×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×›×¨×™×©×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××œ×¤×¤×•× ×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '× ×¢× ×¢', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×¢×œ×™ ×× ×’×•×œ×“', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×¤×˜×¨×•×–×™×œ×™×”', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×¤×˜×¨×™×•×ª', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×¤×œ×¤×œ ×—×¨×™×£', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×¤×œ×¤×œ×™×', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×§×•×œ×•×¨×‘×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×§×™×©×•×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¨×•×–××¨×™×Ÿ', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×¨×•×§×˜/××•×¨×•×’×•×œ×”', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×©×•×', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×©×•××¨', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×©×•×¨×© ×¡×œ×¨×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×©×•×¨×© ×¤×˜×¨×•×–×™×œ×™×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×©××™×¨', unit: '×¦×¨×•×¨', step: 1, min: 1 },
                { name: '×ª×™×¨×¡', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×ª×¤×•×—×™ ××“××”', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×ª×¨×“ ×˜×¨×™', unit: '×¦×¨×•×¨', step: 1, min: 1 }
            ],
            'ğŸ ×¤×™×¨×•×ª': [
                { name: '××‘×•×§×“×•', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××‘×˜×™×—', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××’×¡', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '××¤×¨×¡×§×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '××©×›×•×œ×™×•×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×‘× × ×•×ª', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×œ×™×™×', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×œ×™××•×Ÿ', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××œ×•×Ÿ', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×× ×’×•', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '× ×§×˜×¨×™× ×•×ª', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¢× ×‘×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×§×œ×× ×˜×™× ×•×ª', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×©×–×™×¤×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×ª×¤×•×–×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×ª×¤×•×—×™×', unit: '×§"×’', step: 0.5, min: 0.5 }
            ],
            'ğŸ¥› ××•×¦×¨×™ ×—×œ×‘ ×•×‘×™×¦×™×': [
                { name: '××§×˜×™××œ', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×‘×™×¦×™×', unit: '×ª×‘× ×™×ª', step: 1, min: 1 },
                { name: '×‘×¨×™', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’××•×“×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’×‘×™× ×” ×›×—×•×œ×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’×‘×™× ×” ×œ×‘× ×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×’×‘×™× ×” ×¦×”×•×‘×” ××’×•×¨×“×ª', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’×‘×™× ×” ×¦×”×•×‘×” ×¤×¨×•×¡×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: "×’×‘×™× ×ª ×¤×¨××–'×Ÿ ××’×•×¨×“×ª", unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×’×‘×™× ×ª ×©×× ×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×“× ×™/××™×œ×§×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×—×œ×‘', unit: '×œ×™×˜×¨', step: 1, min: 1 },
                { name: '×—×××”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×™×•×’×•×¨×˜', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×™×•×’×•×¨×˜ ×˜×‘×¢×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×œ×‘× ×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××•×¦×¨×œ×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: "×× ×¦'×’×•", unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '××¡×§×¨×¤×•× ×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×¦×¤×ª×™×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: "×¤×¨××–'×Ÿ", unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: "×§×•×˜×’'", unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×§×××‘×¨', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×¨×™×§×•×˜×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×©×× ×ª ×œ×‘×™×©×•×œ', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×©×× ×ª ×œ×”×§×¦×¤×”', unit: '×™×—×™×“×•×ª', step: 1, min: 1 }
            ],
            'ğŸ¥– ×××¤×™× ×•×œ×—××™×': [
                { name: '×‘×¦×§ ×¢×œ×™×', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: "×’'×—× ×•×Ÿ", unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×˜×•×¨×˜×™×”', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×œ×—× ×¤×¨×•×¡', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×œ×—×× ×™×•×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××œ×•×•××—', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×¤×™×ª×•×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×¤×¡×˜×”', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×§×•×¨× ×¤×œ×§×¡/×’×¨× ×•×œ×”', unit: '×§×•×¤×¡×”', step: 1, min: 1 },
                { name: '×§×¨×§×¨×™×', unit: '×—×‘×™×œ×”', step: 1, min: 1 }
            ],
            'ğŸ§‚ ××–×•×•×” ×•×ª×‘×œ×™× ×™×': [
                { name: '××•×¨×–', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×—×•××•×¡ ×‘×©×™××•×¨×™×', unit: '×¤×—×™×ª', step: 1, min: 1 },
                { name: '×—×•××•×¡ ×™×‘×©', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×˜×•× ×” ×‘×©×™××•×¨×™×', unit: '×¤×—×™×ª', step: 1, min: 1 },
                { name: '×˜×—×™× ×”', unit: '×¦× ×¦× ×ª', step: 1, min: 1 },
                { name: '×›××•×Ÿ', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '××™×•× ×–', unit: '×¦× ×¦× ×ª', step: 1, min: 1 },
                { name: '××œ×—', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '××¨×§ ×¢×•×£ ×¦××—×™', unit: '×§×•×¤×¡×”', step: 1, min: 1 },
                { name: '×¡×•×›×¨', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¡×•×›×¨ ×•× ×™×œ', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×¢×“×©×™×', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×¤×œ×¤×œ ×©×—×•×¨', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×¤×¤×¨×™×§×”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×¤×¨×•×¨×™ ×œ×—×', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×§×˜×©×•×¤', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×§××—', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¨×•×˜×‘ ×¡×•×™×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×¨×¡×§ ×¢×’×‘× ×™×•×ª ××•×˜×™', unit: '×¤×—×™×ª', step: 1, min: 1 },
                { name: '×©×•×§×•×œ×™×ª', unit: '×¦× ×¦× ×ª', step: 1, min: 1 },
                { name: '×©×•× ×’×‘×™×©×™', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×©××Ÿ ×–×™×ª', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×©××Ÿ ×§× ×•×œ×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×©×¢×•×¢×™×ª', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×ª×™×¨×¡ ×‘×©×™××•×¨×™×', unit: '×¤×—×™×ª', step: 1, min: 1 }
            ],
            'ğŸ¥© ×‘×©×¨ ×¢×•×£ ×•×“×’×™×': [
                { name: '××•×¡×•×‘×•×§×•', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×× ×˜×¨×™×§×•×˜', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×‘×©×¨ ×˜×—×•×Ÿ', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×’×œ×™×“×”', unit: '×œ×™×˜×¨', step: 1, min: 1 },
                { name: '×’×¨×•× ×•×ª ×”×•×“×•', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×“×’ ×˜×¨×™', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×“×’×™× ×§×¤×•××™×', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×˜×•×¤×•', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×™×¨×§×•×ª ×§×¤×•××™×', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×›× ×¤×™×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×›×¨×¢×™×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×œ×‘×‘×•×ª ×¢×•×£', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '× ×§× ×™×§×™×•×ª ×‘×§×¨', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '× ×§× ×™×§×™×•×ª ×™×œ×“×™×', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '× ×§× ×™×§×™×•×ª ×¢×•×£', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×¡×˜×™×™×§ ×¡×™× ×˜×”', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¡×œ××•×Ÿ, ×¤×™×œ×”', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¤×¡×˜×¨××”', unit: '×§"×’', step: 0.1, min: 0.1 },
                { name: '×¤×¨×’×™×•×ª', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: "×¦'×™×¤×¡ ×§×¤×•×", unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×¦×•×•××¨ ×‘×§×¨', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×¦×œ×™ ×›×ª×£', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×©×•×§×™×™×', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×©×™×™×˜×œ', unit: '×§"×’', step: 0.5, min: 0.5 },
                { name: '×ª×—×œ×™×£ ×‘×©×¨', unit: '×—×‘×™×œ×”', step: 1, min: 1 }
            ],
            'ğŸ¥¤ ×©×ª×™×™×” ×•×—×˜×™×¤×™×': [
                { name: '×—×˜×™×¤×™× ××œ×•×—×™×', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×—×œ×‘ ×¡×•×™×”/×©×§×“×™×', unit: '×œ×™×˜×¨', step: 1, min: 1 },
                { name: '××™× ××™× ×¨×œ×™×™×', unit: '×©×™×©×™×”', step: 1, min: 1 },
                { name: '××™×¦×™×', unit: '×œ×™×˜×¨', step: 1, min: 1 },
                { name: '×¡×•×“×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×¢×•×’×™×•×ª', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×§×¤×”', unit: '×©×§×™×ª', step: 1, min: 1 },
                { name: '×©×•×§×•×œ×“', unit: '×˜×‘×œ×”', step: 1, min: 1 },
                { name: '×ª×”', unit: '×§×•×¤×¡×”', step: 1, min: 1 }
            ],
            'ğŸ§¹ × ×™×§×™×•×Ÿ ×•×›×‘×™×¡×”': [
                { name: '00 ×™×¨×•×§', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: "××‘×§×ª ×›×‘×™×¡×”/×’'×œ", unit: '×§×•×¤×¡×”', step: 1, min: 1 },
                { name: '××§×•× ×•××™×§×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×—×•××¨ ×œ× ×™×§×•×™ ×¨×¦×¤×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '××‘×¨×™×§ × ×™×¨×•×¡×˜×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '××’×‘×•× ×™× ×œ×—×™× ×œ× ×™×§×•×™', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '××¨×›×š ×›×‘×™×¡×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '× ×•×–×œ ×›×œ×™×', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×¡×¤×•×’×™× ×œ×›×œ×™×', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×©×§×™×•×ª ×–×‘×œ', unit: '×’×œ×™×œ', step: 1, min: 1 }
            ],
            'ğŸ§´ ×˜×•××œ×˜×™×§×”': [
                { name: '×“××•×“×•×¨× ×˜', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×—×•×˜ ×“× ×˜×œ×™', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×˜××¤×•× ×™×/×ª×—×‘×•×©×•×ª', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×›×¤×¤×•×ª ×—×“ ×¤×¢××™×•×ª ×œ×œ× ××‘×§×”', unit: '×§×•×¤×¡×”', step: 1, min: 1 },
                { name: '××‘×¨×©×•×ª ×©×™× ×™×™×', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '××’×‘×•× ×™ ××£/×˜×™×©×•', unit: '×§×•×¤×¡×”', step: 1, min: 1 },
                { name: '××™ ×¤×”', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '××¨×›×š ×©×™×¢×¨', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '××©×—×ª ×©×™× ×™×™×', unit: '×©×¤×•×¤×¨×ª', step: 1, min: 1 },
                { name: '× ×™×™×¨ ×˜×•××œ×˜', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '×¡×‘×•×Ÿ ×’×•×£', unit: '×‘×§×‘×•×§', step: 1, min: 1 },
                { name: '×©××¤×•', unit: '×‘×§×‘×•×§', step: 1, min: 1 }
            ],
            'ğŸ  ×©×•× ×•×ª ×œ×‘×™×ª': [
                { name: '×’×¤×¨×•×¨×™×/××¦×™×ª', unit: '×™×—×™×“×•×ª', step: 1, min: 1 },
                { name: '×–×™×¤×œ×•×§/×©×§×™×•×ª ×¢× ×¡×’×™×¨×”', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: '× ×™×™×¨ ××œ×•××™× ×™×•×', unit: '×’×œ×™×œ', step: 1, min: 1 },
                { name: '× ×™×™×¨ ××¤×™×™×”', unit: '×’×œ×™×œ', step: 1, min: 1 },
                { name: '×¡×•×œ×œ×•×ª', unit: '×—×‘×™×œ×”', step: 1, min: 1 },
                { name: "×©×§×™×•×ª ×¡× ×“×•×•×™×¦'×™×", unit: '×—×‘×™×œ×”', step: 1, min: 1 }
            ]
        };

        const CATEGORY_ICONS = {
            'ğŸ¥¬ ×™×¨×§×•×ª': 'ğŸ¥¬',
            'ğŸ ×¤×™×¨×•×ª': 'ğŸ',
            'ğŸ¥› ××•×¦×¨×™ ×—×œ×‘ ×•×‘×™×¦×™×': 'ğŸ¥›',
            'ğŸ¥– ×××¤×™× ×•×œ×—××™×': 'ğŸ¥–',
            'ğŸ§‚ ××–×•×•×” ×•×ª×‘×œ×™× ×™×': 'ğŸ§‚',
            'ğŸ¥© ×‘×©×¨ ×¢×•×£ ×•×“×’×™×': 'ğŸ¥©',
            'ğŸ¥¤ ×©×ª×™×™×” ×•×—×˜×™×¤×™×': 'ğŸ¥¤',
            'ğŸ§¹ × ×™×§×™×•×Ÿ ×•×›×‘×™×¡×”': 'ğŸ§¹',
            'ğŸ§´ ×˜×•××œ×˜×™×§×”': 'ğŸ§´',
            'ğŸ  ×©×•× ×•×ª ×œ×‘×™×ª': 'ğŸ '
        };

        const CATEGORY_COLORS = {
            'ğŸ¥¬ ×™×¨×§×•×ª': 'linear-gradient(135deg, #4ade80, #10b981)',
            'ğŸ ×¤×™×¨×•×ª': 'linear-gradient(135deg, #f87171, #ef4444)',
            'ğŸ¥› ××•×¦×¨×™ ×—×œ×‘ ×•×‘×™×¦×™×': 'linear-gradient(135deg, #60a5fa, #0ea5e9)',
            'ğŸ¥– ×××¤×™× ×•×œ×—××™×': 'linear-gradient(135deg, #fbbf24, #f97316)',
            'ğŸ§‚ ××–×•×•×” ×•×ª×‘×œ×™× ×™×': 'linear-gradient(135deg, #fb7185, #ec4899)',
            'ğŸ¥© ×‘×©×¨ ×¢×•×£ ×•×“×’×™×': 'linear-gradient(135deg, #f87171, #dc2626)',
            'ğŸ¥¤ ×©×ª×™×™×” ×•×—×˜×™×¤×™×': 'linear-gradient(135deg, #a78bfa, #8b5cf6)',
            'ğŸ§¹ × ×™×§×™×•×Ÿ ×•×›×‘×™×¡×”': 'linear-gradient(135deg, #22d3ee, #14b8a6)',
            'ğŸ§´ ×˜×•××œ×˜×™×§×”': 'linear-gradient(135deg, #f472b6, #ec4899)',
            'ğŸ  ×©×•× ×•×ª ×œ×‘×™×ª': 'linear-gradient(135deg, #94a3b8, #6b7280)'
        };

        const STORAGE_KEY = 'marom_shopping_list_v5';

        let categories = {};
        let selectedItems = {};
        let quantities = {};
        let boughtItems = {};
        let activeCategory = '×›×œ ×”×§×˜×’×•×¨×™×•×ª';

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                categories = {};
                Object.keys(DEFAULT_CATEGORIES).forEach(cat => {
                    categories[cat] = [...DEFAULT_CATEGORIES[cat]];
                    const defaultNames = DEFAULT_CATEGORIES[cat].map(i => i.name);
                    const customItems = (data.categories?.[cat] || []).filter(
                        item => !defaultNames.includes(item.name)
                    );
                    categories[cat] = [...categories[cat], ...customItems];
                });
                selectedItems = data.selectedItems || {};
                quantities = data.quantities || {};
                boughtItems = data.boughtItems || {};
            } else {
                categories = {};
                Object.keys(DEFAULT_CATEGORIES).forEach(cat => {
                    categories[cat] = [...DEFAULT_CATEGORIES[cat]];
                });
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                categories,
                selectedItems,
                quantities,
                boughtItems
            }));
        }

        function initFilters() {
            const filter = document.getElementById('categoryFilter');
            const newItemCat = document.getElementById('newItemCategory');
            
            filter.innerHTML = '<option value="×›×œ ×”×§×˜×’×•×¨×™×•×ª">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>';
            newItemCat.innerHTML = '';
            
            Object.keys(DEFAULT_CATEGORIES).forEach(cat => {
                filter.innerHTML += `<option value="${cat}">${cat}</option>`;
                newItemCat.innerHTML += `<option value="${cat}">${cat}</option>`;
            });

            filter.value = activeCategory;
            filter.addEventListener('change', (e) => {
                activeCategory = e.target.value;
                renderCategories();
            });
        }

        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            const categoriesToShow = activeCategory === '×›×œ ×”×§×˜×’×•×¨×™×•×ª' 
                ? Object.keys(categories) 
                : [activeCategory];

            categoriesToShow.forEach(cat => {
                if (!categories[cat]) return;
                
                const items = categories[cat];
                const selectedCount = items.filter(item => 
                    selectedItems[`${cat}|${item.name}`]
                ).length;

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon" style="background: ${CATEGORY_COLORS[cat] || 'linear-gradient(135deg, #94a3b8, #6b7280)'}">
                            ${CATEGORY_ICONS[cat] || 'ğŸ“¦'}
                        </div>
                        <span class="category-title">${cat}</span>
                        ${selectedCount > 0 ? `<span class="category-badge">${selectedCount} × ×‘×—×¨×•</span>` : ''}
                    </div>
                    <div class="category-items">
                        ${items.map(item => renderItem(cat, item)).join('')}
                    </div>
                `;
                container.appendChild(card);
            });

            document.querySelectorAll('.item-row').forEach(row => {
                row.addEventListener('click', (e) => {
                    if (e.target.closest('.quantity-controls')) return;
                    const cat = row.dataset.category;
                    const name = row.dataset.name;
                    toggleItem(cat, name);
                });
            });

            document.querySelectorAll('.qty-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const row = btn.closest('.item-row');
                    const cat = row.dataset.category;
                    const name = row.dataset.name;
                    const input = row.querySelector('input[type="number"]');
                    const item = categories[cat].find(i => i.name === name);
                    const step = item.step || 1;
                    const min = item.min || 1;
                    
                    let currentVal = parseFloat(input.value);
                    if (btn.classList.contains('qty-plus')) {
                        input.value = (currentVal + step).toFixed(step < 1 ? 1 : 0);
                    } else {
                        input.value = Math.max(min, currentVal - step).toFixed(step < 1 ? 1 : 0);
                    }
                    updateQuantity(cat, name, input.value);
                });
            });

            document.querySelectorAll('.qty-input').forEach(input => {
                input.addEventListener('click', (e) => e.stopPropagation());
                input.addEventListener('change', (e) => {
                    const row = input.closest('.item-row');
                    const cat = row.dataset.category;
                    const name = row.dataset.name;
                    const item = categories[cat].find(i => i.name === name);
                    const min = item.min || 1;
                    let val = parseFloat(e.target.value) || min;
                    val = Math.max(min, val);
                    e.target.value = val.toFixed(item.step < 1 ? 1 : 0);
                    updateQuantity(cat, name, val);
                });
            });
        }

        function renderItem(cat, item) {
            const key = `${cat}|${item.name}`;
            const isSelected = selectedItems[key];
            const step = item.step || 1;
            const min = item.min || 1;
            const qty = quantities[key] || min;
            const displayQty = step < 1 ? parseFloat(qty).toFixed(1) : qty;

            return `
                <div class="item-row ${isSelected ? 'selected' : ''}" 
                     data-category="${cat}" 
                     data-name="${item.name}">
                    <div class="checkbox"></div>
                    <span class="item-name ${item.isCustom ? 'custom' : ''}">${item.name}</span>
                    <div class="quantity-controls">
                        <button class="qty-btn qty-minus">âˆ’</button>
                        <input type="number" class="qty-input" value="${displayQty}" min="${min}" step="${step}">
                        <button class="qty-btn qty-plus">+</button>
                        <span class="unit-label">${item.unit}</span>
                    </div>
                </div>
            `;
        }

        function toggleItem(cat, name) {
            const key = `${cat}|${name}`;
            selectedItems[key] = !selectedItems[key];
            if (selectedItems[key] && !quantities[key]) {
                const item = categories[cat].find(i => i.name === name);
                quantities[key] = item.min || 1;
            }
            saveData();
            renderCategories();
        }

        function updateQuantity(cat, name, value) {
            const key = `${cat}|${name}`;
            const item = categories[cat].find(i => i.name === name);
            const min = item.min || 1;
            quantities[key] = Math.max(min, parseFloat(value) || min);
            saveData();
        }

        function showAllCategories() {
            activeCategory = '×›×œ ×”×§×˜×’×•×¨×™×•×ª';
            document.getElementById('categoryFilter').value = activeCategory;
            renderCategories();
        }

        function clearAllSelections() {
            selectedItems = {};
            quantities = {};
            saveData();
            renderCategories();
            showToast('×›×œ ×”×¡×™××•× ×™× × ×•×§×•');
        }

        function toggleAddForm() {
            const form = document.getElementById('addItemForm');
            form.classList.toggle('show');
            if (form.classList.contains('show')) {
                document.getElementById('newItemName').focus();
            }
        }

        function addNewItem() {
            const name = document.getElementById('newItemName').value.trim();
            const cat = document.getElementById('newItemCategory').value;
            
            if (!name || !cat) return;

            categories[cat].push({ name, unit: '×™×—×™×“×•×ª', step: 1, min: 1, isCustom: true });
            categories[cat].sort((a, b) => a.name.localeCompare(b.name, 'he'));
            document.getElementById('newItemName').value = '';
            toggleAddForm();
            saveData();
            renderCategories();
            showToast(`${name} × ×•×¡×£ ×œ×§×˜×’×•×¨×™×” ${cat}`);
        }

        function generateList() {
            let text = 'ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª ××©×¤×—×ª ××¨×•×\n';
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
            
            Object.keys(categories).forEach(cat => {
                const items = categories[cat].filter(item => 
                    selectedItems[`${cat}|${item.name}`]
                );
                if (items.length > 0) {
                    text += `ğŸ“Œ ${cat}:\n`;
                    items.forEach(item => {
                        const key = `${cat}|${item.name}`;
                        const qty = quantities[key] || item.min || 1;
                        const displayQty = item.step < 1 ? parseFloat(qty).toFixed(1) : qty;
                        text += `   â—‹ ${item.name} - ${displayQty} ${item.unit}\n`;
                    });
                    text += '\n';
                }
            });
            
            document.getElementById('summaryText').value = text;
            showToast('×”×¨×©×™××” × ×•×¦×¨×” ×‘×”×¦×œ×—×”');
        }

        function generateChecklist() {
            boughtItems = {};
            saveData();
            renderChecklist();
            document.getElementById('checklistCard').scrollIntoView({ behavior: 'smooth' });
            showToast('×¦\'×§ ×œ×™×¡×˜ × ×•×¦×¨');
        }

        function renderChecklist() {
            const content = document.getElementById('checklistContent');
            const selectedCategories = {};
            
            Object.keys(categories).forEach(cat => {
                const items = categories[cat].filter(item => 
                    selectedItems[`${cat}|${item.name}`]
                );
                if (items.length > 0) {
                    selectedCategories[cat] = items;
                }
            });

            const totalItems = Object.values(selectedCategories).reduce(
                (sum, items) => sum + items.length, 0
            );
            
            let boughtCount = 0;
            Object.values(selectedCategories).forEach(items => {
                items.forEach(item => {
                    Object.keys(selectedCategories).forEach(cat => {
                        if (selectedCategories[cat].includes(item)) {
                            if (boughtItems[`${cat}|${item.name}`]) boughtCount++;
                        }
                    });
                });
            });

            const badge = document.getElementById('progressBadge');
            badge.textContent = `${boughtCount}/${totalItems}`;
            badge.className = `progress-badge ${boughtCount === totalItems && totalItems > 0 ? 'complete' : ''}`;

            if (totalItems === 0) {
                content.innerHTML = `
                    <div class="checklist-empty">
                        <div class="checklist-empty-icon">ğŸ›’</div>
                        <p>×¡×× ×• ×¤×¨×™×˜×™× ×‘×¨×©×™××” ×•×œ×—×¦×• ×¢×œ "×¦'×§ ×œ×™×¡×˜ ×œ×¡×•×¤×¨"</p>
                    </div>
                `;
                return;
            }

            let html = '';
            Object.entries(selectedCategories).forEach(([cat, items]) => {
                html += `<div class="checklist-category">
                    <div class="checklist-category-title">${cat}</div>`;
                items.forEach(item => {
                    const key = `${cat}|${item.name}`;
                    const isBought = boughtItems[key];
                    const qty = quantities[key] || item.min || 1;
                    const displayQty = item.step < 1 ? parseFloat(qty).toFixed(1) : qty;
                    html += `
                        <div class="checklist-item ${isBought ? 'bought' : ''}" 
                             data-category="${cat}" 
                             data-name="${item.name}">
                            <div class="checklist-checkbox"></div>
                            <span class="checklist-item-name">${item.name}</span>
                            <span class="checklist-item-qty">${displayQty} ${item.unit}</span>
                            <span class="checklist-done-icon">âœ“</span>
                        </div>
                    `;
                });
                html += '</div>';
            });

            html += `<button class="btn btn-completion btn-full" onclick="generateCompletionList()">
                ğŸ“ ×™×¦×™×¨×ª ×¨×©×™××ª ×”×©×œ××•×ª
            </button>`;

            if (boughtCount === totalItems && totalItems > 0) {
                html += `
                    <div class="success-message">
                        <div class="success-pill">âœ“ ×¡×™×™××ª×! ×›×œ ×”×¤×¨×™×˜×™× × ×œ×§×—×• ğŸ‰</div>
                    </div>
                `;
            }

            content.innerHTML = html;

            document.querySelectorAll('.checklist-item').forEach(item => {
                item.addEventListener('click', () => {
                    const cat = item.dataset.category;
                    const name = item.dataset.name;
                    toggleBought(cat, name);
                });
            });
        }

        function toggleBought(cat, name) {
            const key = `${cat}|${name}`;
            boughtItems[key] = !boughtItems[key];
            saveData();
            renderChecklist();
        }

        function generateCompletionList() {
            let text = 'ğŸ“‹ ×¨×©×™××ª ×”×©×œ××•×ª\n';
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
            
            Object.keys(categories).forEach(cat => {
                const items = categories[cat].filter(item => {
                    const key = `${cat}|${item.name}`;
                    return selectedItems[key] && !boughtItems[key];
                });
                if (items.length > 0) {
                    text += `ğŸ“Œ ${cat}:\n`;
                    items.forEach(item => {
                        const key = `${cat}|${item.name}`;
                        const qty = quantities[key] || item.min || 1;
                        const displayQty = item.step < 1 ? parseFloat(qty).toFixed(1) : qty;
                        text += `   â—‹ ${item.name} - ${displayQty} ${item.unit}\n`;
                    });
                    text += '\n';
                }
            });
            
            document.getElementById('summaryText').value = text;
            showToast('×¨×©×™××ª ×”×”×©×œ××•×ª × ×•×¦×¨×”');
        }

        function clearSummary() {
            document.getElementById('summaryText').value = '';
        }

        function copyToClipboard() {
            const text = document.getElementById('summaryText').value;
            if (!text) {
                showToast('××™×Ÿ ×¨×©×™××” ×œ×”×¢×ª×§×”');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showToast('×”×¨×©×™××” ×”×•×¢×ª×§×” ×œ×œ×•×—!');
            });
        }

        function fullReset() {
            if (confirm('×”×× ×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×? ×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”×‘×—×™×¨×•×ª ×•×”×¤×¨×™×˜×™× ×”××•×ª×××™× ××™×©×™×ª.')) {
                localStorage.removeItem(STORAGE_KEY);
                categories = {};
                Object.keys(DEFAULT_CATEGORIES).forEach(cat => {
                    categories[cat] = [...DEFAULT_CATEGORIES[cat]];
                });
                selectedItems = {};
                quantities = {};
                boughtItems = {};
                document.getElementById('summaryText').value = '';
                renderCategories();
                renderChecklist();
                showToast('×›×œ ×”× ×ª×•× ×™× ××•×¤×¡×•');
            }
        }

        function toggleMoreActions() {
            document.getElementById('moreActions').classList.toggle('show');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initFilters();
            renderCategories();
            renderChecklist();

            document.getElementById('newItemName').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addNewItem();
            });
        });
    </script>
</body>
</html>
